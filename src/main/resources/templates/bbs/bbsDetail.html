<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>bbs_list</title>
	<link rel="stylesheet" th:href="@{/css/style.css}" />
</head>
<body>
<div class="container">
	<h2 class="title">게시글 상세 화면</h2>
	<form id="frm" method="post">
		<table class="table table-striped">
			<colgroup>
				<col width="15%" />
				<col width="35%" />
				<col width="15%" />
				<col width="35%" />
			</colgroup>
			<tbody>
			<tr>
				<th scope="row">글 번호</th>
				<td th:text="${bbs.bbsId}"></td>
				<th scope="row">조회수</th>
				<td th:text="${bbs.viewCnt}"></td>
			</tr>
			<tr>
				<th scope="row">작성자</th>
				<td th:text="${bbs.memberCode}"></td>
				<th scope="row">작성일</th>
				<td th:text="${#temporals.format(bbs.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
			<tr>
				<th scope="row">제목</th>
				<td colspan="3" th:text="${bbs.title}"></td>
			</tr>
			<tr>
				<th scope="row">
					<span class="hidden">내용</span>
				</th>
				<td th:text="${bbs.contents}"></td>
			</tr>
			<tr th:each="country : ${country}">
				<!-- 각 대륙 국가 내용 출력 -->
				<th scope="col">국 가</th>
				<td th:text="${country.countryName}"></td>
				<th scope="col">대 륙</th>
				<td th:text="${country.continentName}"></td>
			</tr>
			</tbody>
		</table>
		<input type="hidden" id="bbsId" name="bbsId" th:value="${bbs.bbsId}">	<!-- 여기서 아이디 받아서 저장-->
		<input type="hidden" id="method" name="_method" />
		<br>
	</form>
	<form id="deleteCommentsForm" action="/delete" method="post">
		<th scope="row">댓글</th>
		<tr th:each="comment : ${comments}">
			<td>
				<input type="checkbox" name="commentIds" value="${comment.commentID}"/>
			</td>
			<!-- 각 댓글의 내용 출력 -->
			<td th:text="${comment.writer}"></td>
			<td th:text="${comment.content}"></td>
		</tr>
		<button type="submit">선택된 댓글 삭제</button>
	</form>
	<a href="#this" id="list" class="btn">목록으로</a>
	<a href="#this" id="edit" class="btn" th:if="${bbs != null and bbs.memberCode == loginId}">수정</a>
	<a href="#this" id="delete" class="btn" th:if="${bbs != null and bbs.memberCode == loginId}">삭제</a>
	<a href="#this" id="chatButton" class="btn" th:attr="data-roomId=${bbs.bbsId}" th:onclick="enterChatRoom(this.getAttribute('data-roomId'))">채팅하기</a>
	<!-- 댓글 작성 폼 -->
	<div id="comment-write">
		<form id="commentForm" action="/comment/save" method="post">
			<div>
				<!-- bbsId를 전달하기 위한 hidden input 추가 -->
				<input type="hidden" name="bbsId" id="bbsId" th:value="${bbs.bbsId.toString()}">
			</div>
			<div>
				<input type="text" name="writer" id="writer" placeholder="작성자">
				<!--  추후 로그인 세션을 가져오면 여기에 작성자값 넣어 readonly -->
			</div>
			<div>
				<textarea  name="content" id="content" placeholder="내용" style="resize:none;"></textarea>
				<button type="submit" id="comment-write-btn">댓글작성</button>
			</div>
		</form>
	</div>
</div>
<script th:inline="javascript">
	var loginId = [[${loginId}]]; // Make sure to replace 'null' with the actual loginId
	function enterChatRoom(bbsId) {
		if(loginId != null) {
			localStorage.setItem('wschat.sender',loginId);
			localStorage.setItem('wschat.roomId',bbsId);
			location.href="/chat/room/enter/"+bbsId;
		} else{
			location.href="/member/login"
		}
	}
</script>
</body>
</html>